<!DOCTYPE html>
<html>
<head>
	<title>pebble-plex-remote config</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	
	<link href="css/bootstrap.min.css" rel="stylesheet">
	<link href="css/bootstrap-theme.min.css" rel="stylesheet">
	<link href="css/style.css" rel="stylesheet">

	<script type="text/javascript" src="js/jquery.min.js"></script>
	
</head>
<body>
    <div class="container">
		<h2 class="">Configure Plex Remote</h2>
    	<form id="configure" class="form-configure well" action="#" method="POST">
        	<div class="form-group">
        		<label for="plexServer">Plex Server</label>
        		<input type="text" id="plexServer" name="plexServer" class="form-control" placeholder="192.168.1.117"/>
			</div>	
			<p class="help-block">Enter a hostname or IP address of a Plex Server before selecting a Plex Client.</p>
			<input class="btn btn-lg btn-info btn-block" id="getClients" value="Get Clients"/>
			<br/>
			<div class="form-group">
        		<label for="plexClient">Plex Client</label>
        		
        		<select id="plexClient" name="plexClient" class="form-control">
        			<option value="" selected>Select a Client</option>
        		</select>
        	</div>
        	<div class="form-group hide">
        		<label for="plexToken">Plex Token</label>
        		<input type="text" class="form-control" id="plexToken" name="plexToken" placeholder="gXiKAPVGo9GqNzKY1q9t" value="gXiKAPVGo9GqNzKY1q9t"/>
        	</div>
        	
        	<input class="btn btn-lg btn-primary btn-block" id="save" type="submit" value="Save"/>

      </form>
    </div>
    <div class="footer container">
    	<p><a href="http://github.com/spangborn/pebble-plex-remote">Plex Remote</a> by <a href="http://twitter.com/spangborn">Sawyer Pangborn</a></p>
    </div>
	<script type="text/javascript">
		$().ready(function () {
			$("#getClients").click(function(){
				$.ajax({
					"url" : "http://" + $("#plexServer").val() + ":32400/clients",
					"dataType" : "xml",
					"type" : "GET",
					"success" : function (data) {
						$("#clientSelect").empty();
						something = $(data).find("Server");
						var $clients = $(data).find("Server");
						$.each($clients, function (i,item) {
							var client = $("<option>", {
								"value" : $(item).attr("host"),
								"html" : $(item).attr("name") + " (" + $(item).attr("host") +")"
							}).appendTo($("#plexClient"));
						});
					},
					"error" : {

					}

				});
			});

		});

		$("#plexServer").val(localStorage.getItem("plexServer"));
		$("#plexClient").val(localStorage.getItem("plexClient"));
		$("#configure").submit(function(e) {
			var s = $("#plexServer").val();
			var c = $("#plexClient").val();

			var j = {
				plexServer : s,
				plexClient : c
			};

    		localStorage.setItem("plexServer", s);  
			localStorage.setItem("plexClient", c); 

			window.location.href = "pebblejs://close#" + JSON.stringify(j);

			e.preventDefault();
		});	

	
</script>
</body>
</html>